<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>注册</title>
    <link href="./css/bootstrap.min.css" media="screen" rel="stylesheet" type="text/css"/>
</head>
<body>
<div class="container" style="margin-top: 10%">
    <form class="form-horizontal" id="form">
        <legend></legend>
        <div class="control-group">
            <label class="control-label">Username:</label>
            <div class="controls"><input type="text" name="username" id="username"><span
                    id="repeat"></span></div>
        </div>
        <div class="control-group">
            <label class="control-label">Password:</label>
            <div class="controls"><input type="password" name="password" id="password"></div>
        </div>

        <div class="form-actions">
            <button type="button" class="btn btn-primary" id="submit">register</button>
            <button type="reset" class="btn">reset</button>
        </div>
    </form>
</div>
</body>
<script src="./js/jquery-3.1.1.min.js"></script>
<script>
    $(function () {
        $("#username").blur(function () {
            var username = $("#username").val();
            $.get("../user/checkUsername?username=" + username, function (data) {
                var result = $.parseJSON(data);
                if (!result) {
                    $("#repeat").html("用户名重复")
                } else {
                    $("#repeat").html("可用")
                }
            });
        });
        $("#submit").click(function () {
            var username = $("#username").val();
            var password = $("#password").val();
            $.ajax({
                type: "POST",
                url: "../user/register",
                contentType: "application/json",
                data: JSON.stringify({
                    "username": username,
                    "password": password
                }),
                success: function (data) {
                    var obj = JSON.parse(data);
                    if (obj.code == -1) {
                        if (confirm(obj.description + ",返回登陆？")) {
                            location.href = "login.html";
                        }
                    } else {
                        alert(obj.description);
                    }
                }
            });
        });
    });
</script>
</html>